Ik ga een volledige chat-API bouwen met FastAPI en MongoDB, gebaseerd op je auth-API structuur. Laat me eerst de skills lezen voor best practices.Nu ga ik de chat-API bouwen met een gedegen structuur. Ik zal beginnen met de projectstructuur en alle benodigde componenten.Nu ga ik de Beanie models maken voor MongoDB:Nu de Pydantic schemas:Nu de middleware voor correlation en auth:Nu de services:Nu de WebSocket connection manager:Nu de routes:Nu de WebSocket endpoint:Nu de main.py:Nu een logging config YAML:Nu een .env.example:Nu een README met uitleg en voorbeelden:Nu een test script om te verifiÃ«ren dat alles werkt:Nu maak ik het script executable en een .gitignore:Nu een voorbeeld HTML client voor WebSocket testing:Perfect! Nu ga ik een samenvattend document maken en het project kopiÃ«ren naar /mnt/user-data/outputs:Nu ga ik het hele project kopiÃ«ren naar outputs:Perfect! Laat me een visueel overzicht maken:Perfect! Laat me een overzicht geven van wat ik heb gebouwd:

## ğŸ‰ Chat API - Volledige Implementatie Klaar!

Ik heb een **productie-klare chat API** gebouwd die perfect aansluit op je auth-api architectuur. Hier is wat je hebt gekregen:

### âœ… Kern Features

**1. Real-time WebSocket Chat**
- Live berichten broadcasting
- Connection management per groep
- Ondersteunt meerdere tabs per gebruiker

**2. REST API voor CRUD**
- GET groepen & berichten (met paginatie)
- POST nieuwe berichten  
- PUT berichten updaten (alleen eigen berichten)
- DELETE berichten (soft delete)

**3. MongoDB met Beanie ODM**
- Type-safe document modellen
- Automatische indexes
- Clean Pydantic integratie

**4. Authenticatie & Autorisatie**
- JWT validatie (gedeeld secret met auth-api)
- Groep-gebaseerde autorisatie checks
- User-ID extractie uit tokens

### ğŸ“ Project Structuur

```
chat-api/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py              # FastAPI applicatie
â”‚   â”œâ”€â”€ config.py            # Settings
â”‚   â”œâ”€â”€ core/                # Exceptions & logging
â”‚   â”œâ”€â”€ db/                  # MongoDB connectie
â”‚   â”œâ”€â”€ models/              # Group & Message documents
â”‚   â”œâ”€â”€ schemas/             # Pydantic schemas
â”‚   â”œâ”€â”€ services/            # ChatService & ConnectionManager
â”‚   â”œâ”€â”€ routes/              # Groups, Messages, WebSocket
â”‚   â””â”€â”€ middleware/          # Auth & correlation
â”œâ”€â”€ docker-compose.yml       # MongoDB + API + Redis
â”œâ”€â”€ mongo-init/              # Test data initialisatie
â”œâ”€â”€ test_api.py             # Automated tests
â”œâ”€â”€ websocket-test.html     # Interactive WebSocket client
â”œâ”€â”€ README.md               # Volledige documentatie
â”œâ”€â”€ QUICKSTART.md           # Snelle start gids
â””â”€â”€ ARCHITECTURE.md         # Architectuur diagrammen
```

### ğŸš€ Hoe te Gebruiken

```bash
# Start alles
cd chat-api
docker-compose up -d

# Test de API
python test_api.py

# Open WebSocket client
open websocket-test.html
```

### ğŸ”‘ Belangrijke Design Keuzes

**1. Scheiding van Verantwoordelijkheden**
- Middleware â†’ Routes â†’ Services â†’ Models â†’ Database
- Exact zoals je auth-api

**2. Authorization Model**
```python
# Elke actie controleert eerst:
user_id = get_current_user()  # Van JWT
group = Group.get(group_id)
if user_id not in group.authorized_user_ids:
    raise ForbiddenError()
```

**3. REST + WebSocket Combinatie**
- REST voor initiÃ«le load (GET berichten)
- WebSocket voor real-time updates
- Berichten via REST worden ook via WS gebroadcast

**4. Soft Deletes**
- `is_deleted = true` in plaats van fysiek verwijderen
- Behoudt chat geschiedenis integriteit

### ğŸ“Š Database Schema

**Groups:**
```javascript
{
  _id: ObjectId,
  name: "General",
  description: "...",
  authorized_user_ids: ["uuid1", "uuid2"],
  created_at: Date
}
```

**Messages:**
```javascript
{
  _id: ObjectId,
  group_id: "...",
  sender_id: "uuid",
  content: "Hello!",
  created_at: Date,
  updated_at: Date,
  is_deleted: false
}
```

### ğŸ§ª Testing

**Automated Tests:**
```bash
python test_api.py
```

**Interactive WebSocket Test:**
Open `websocket-test.html` in browser

**Manual cURL:**
```bash
curl -H "Authorization: Bearer TOKEN" \
  http://localhost:8001/api/chat/groups
```

### ğŸ“ API Endpoints

```
GET    /api/chat/groups
GET    /api/chat/groups/{id}
GET    /api/chat/groups/{id}/messages?page=1&page_size=50
POST   /api/chat/groups/{id}/messages
PUT    /api/chat/messages/{id}
DELETE /api/chat/messages/{id}
WS     /api/chat/ws/{group_id}?token=JWT
```

### ğŸ”§ Integratie met Auth-API

1. **Zelfde JWT Secret** - Zet in beide `.env` files
2. **User UUIDs** - Van auth-api gebruikers
3. **Voeg users toe aan groepen** via MongoDB:
```javascript
db.groups.updateOne(
  { name: "General" },
  { $push: { authorized_user_ids: "user-uuid" } }
)
```

### ğŸ Bonus Files

- **websocket-test.html** - Volledig werkende chat client voor testing
- **test_api.py** - Complete test suite
- **ARCHITECTURE.md** - Visuele diagrammen van het systeem
- **QUICKSTART.md** - Snelle start zonder gedoe

### ğŸ› ï¸ Production Ready Features

- âœ… Structured JSON logging
- âœ… Correlation IDs voor request tracing
- âœ… Prometheus metrics endpoint
- âœ… Health check endpoint
- âœ… CORS configuratie
- âœ… Error handling
- âœ… Input validatie

Alles staat klaar in `/mnt/user-data/outputs/chat-api/`!

Wil je dat ik iets toelicht of aanpas? ğŸš€
