# Application
APP_NAME="Chat API"
DEBUG=false
ENVIRONMENT="production"  # development | staging | production

# API Configuration
API_PREFIX="/api/chat"
HOST="0.0.0.0"
PORT=8001

# Logging Configuration
# DEBUG: Very verbose, shows all operations (use for local development)
# INFO: Standard logging, shows important events
# WARNING: Only warnings and errors
# ERROR: Only errors
# CRITICAL: Only critical failures
LOG_LEVEL="INFO"
LOG_JSON_FORMAT=true  # Always true in production for log aggregators
LOG_SQL_QUERIES=false  # NEVER enable in production (security risk + noise)

# MongoDB Configuration
MONGODB_URL="mongodb://localhost:27017"
DATABASE_NAME="chat_db"

# ===== OAuth 2.0 Configuration =====
# JWT Validation (MUST match auth-api settings)
JWT_SECRET_KEY="your-secret-key-change-in-production-min-32-chars"
JWT_ALGORITHM="HS256"

# Service-to-Service OAuth 2.0 (Client Credentials Flow)
# Used by Chat-API to fetch group data from Auth-API
SERVICE_CLIENT_ID="chat-api-service"
SERVICE_CLIENT_SECRET="your-service-secret-change-in-production"
SERVICE_TOKEN_URL="http://auth-api:8000/oauth/token"
SERVICE_SCOPE="groups:read"

# Redis (for caching group data and rate limiting)
REDIS_URL="redis://localhost:6379/0"

# CORS Configuration
CORS_ORIGINS=["http://localhost:3000","http://localhost:8000"]

# ===== RBAC Authorization Settings (DEPRECATED - Legacy System) =====
# Auth API Integration
AUTH_API_URL="http://auth-api:8000"
AUTH_API_TIMEOUT=3.0
AUTH_API_PERMISSION_CHECK_ENDPOINT="/api/v1/authorization/check"  # DEPRECATED

# Authorization Caching (requires Redis)
AUTH_CACHE_ENABLED=true
AUTH_CACHE_TTL_READ=300      # 5 minutes - frequent reads, safe to cache longer
AUTH_CACHE_TTL_WRITE=60      # 1 minute - writes might change data
AUTH_CACHE_TTL_ADMIN=30      # 30 seconds - admin operations need fresh checks
AUTH_CACHE_TTL_DENIED=120    # 2 minutes - cache denials to prevent hammering

# Circuit Breaker (Resilience Pattern)
CIRCUIT_BREAKER_THRESHOLD=5        # Failures before circuit opens
CIRCUIT_BREAKER_TIMEOUT=30         # Seconds circuit stays open
CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=3

# Fallback Behavior (CRITICAL SECURITY SETTING)
# false = Fail-Closed (RECOMMENDED): Deny access if Auth API unavailable
# true = Fail-Open: Allow access if Auth API unavailable (DANGEROUS!)
AUTH_FAIL_OPEN=false
